/*!
 * ng-cordova-settings
 * Copyright 2015 Peter Bakondy https://github.com/pbakondy
 * See LICENSE in this repository for license information
 */
!function(){angular.module("ng-cordova-settings",["ngCordova.plugins.file"]).factory("settings",["$q","$window","$cordovaFile",function(e,r,n){"use strict";function t(){return!r.cordova&&!r.PhoneGap&&!r.phonegap}function i(e){return null===e||"boolean"==typeof e||angular.isNumber(e)||angular.isString(e)||angular.isArray(e)||angular.isObject(e)}function a(e,r,n){for(var t=0,i=r.length;i>t;++t){var o=r[t];if(angular.isObject(o)||angular.isFunction(o))for(var u=Object.keys(o),c=0,s=u.length;s>c;c++){var l=u[c],f=o[l];n&&angular.isObject(f)?(angular.isObject(e[l])||(e[l]=angular.isArray(f)?[]:{}),a(e[l],[f],!0)):angular.isDefined(f)?e[l]=f:delete e[l]}}return e}function o(e){return a(e,[].slice.call(arguments,1),!0)}function u(r){var n=e.defer();if(angular.isUndefined(r))v().then(n.resolve,n.reject);else if(angular.isString(r))v().then(function(e){n.resolve(e[r])},n.reject);else{if(!angular.isArray(r))throw new TypeError("Invalid input parameter");v().then(function(e){for(var t={},i=0,a=r.length;a>i;i++)t[r[i]]=e[r[i]];n.resolve(t)},n.reject)}return n.promise}function c(r,n){var t=e.defer(),a={};if(angular.isString(r)&&angular.isUndefined(n))a[r]=void 0;else if(angular.isString(r)&&i(n))a[r]=n;else{if(!angular.isObject(r)||!angular.isUndefined(n))throw new TypeError("Invalid input parameters");a=r}return v().then(function(e){g(e,a).then(t.resolve,t.reject)},function(){g({},a).then(t.resolve,t.reject)}),t.promise}function s(){var r=e.defer();return v().then(function(e){r.resolve(Object.keys(e))},r.reject),r.promise}function l(){var r=e.defer();return h("{}").then(r.resolve,r.reject),r.promise}function f(){var r=e.defer();return p().then(r.resolve,r.reject),r.promise}function v(){var r=e.defer();return d().then(function(e){if(!e)return r.reject("Empty");var n;try{n=JSON.parse(e)}catch(t){throw new ReferenceError("Damaged settings data")}r.resolve(n)},r.reject),r.promise}function g(r,n){var t=e.defer(),i=o({},r,n);return h(JSON.stringify(i)).then(t.resolve,t.reject),t.promise}function d(){var i=e.defer();return t()?i.resolve(r.localStorage[j]):n.readAsText(cordova.file.dataDirectory,j).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}function h(i){var a=e.defer();return t()?(r.localStorage[j]=i,a.resolve()):n.writeFile(cordova.file.dataDirectory,j,i,!0).then(function(){a.resolve()},function(e){a.reject(e)}),a.promise}function p(){var i=e.defer();return t()?(r.localStorage.removeItem(j),i.resolve()):n.removeFile(cordova.file.dataDirectory,j).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}function m(e){return angular.isString(e)&&e.length>0?(j=e,!0):!1}var j="settings.txt";return{read:u,write:c,keys:s,empty:l,remove:f,setStorageFilename:m}}])}();